---
- command: yum install -y https://rdo.fedorapeople.org/rdo-release.rpm
           creates=/etc/yum.repos.d/rdo-release.repo
- command: yum install -y http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm
           creates=/etc/yum.repos.d/puppetlabs.repo
- yum: name=git state=present
- git: repo=https://github.com/stackforge/packstack
       dest=/opt/packstack
#- command: python setup.py install
#           chdir=/opt/packstack
#- command: python setup.py install_puppet_modules
#           chdir=/opt/packstack
- yum: name=openstack-packstack state=present
- copy: src=files/openrc dest=/home/vagrant/openrc owner=vagrant group=vagrant mode=0644
- lineinfile: dest=/home/vagrant/.bashrc line='source $HOME/openrc'
- copy: src=files/setup.sh dest=/home/vagrant/setup.sh owner=vagrant group=vagrant mode=0755
- copy: src=files/initialize.sh dest=/home/vagrant/initialize.sh mode=0755 owner=vagrant group=vagrant
- filesystem: fstype=xfs dev=/dev/sdb force=yes
- filesystem: fstype=xfs dev=/dev/sdc force=yes

- set_fact: exclude_servers=""
- template: src=files/packstack.answers.j2 dest=/home/vagrant/packstack.answers owner=vagrant group=vagrant

- set_fact: exclude_servers="10.10.0.20,10.10.0.21,10.10.0.30,10.10.0.40"
- template: src=files/packstack.answers.j2 dest=/home/vagrant/controller.answers owner=vagrant group=vagrant

- set_fact: exclude_servers="10,10.0.10,10.10.0.30,10.10.0.40"
- template: src=files/packstack.answers.j2 dest=/home/vagrant/compute.answers owner=vagrant group=vagrant

- set_fact: exclude_servers="10,10.0.10,10.10.0.20,10.10.0.21,10.10.0.40"
- template: src=files/packstack.answers.j2 dest=/home/vagrant/network.answers owner=vagrant group=vagrant

- set_fact: exclude_servers="10,10.0.10,10.10.0.20,10.10.0.21,10.10.0.30"
- template: src=files/packstack.answers.j2 dest=/home/vagrant/storage.answers owner=vagrant group=vagrant
